openapi: '3.0.0'
info:
  version: 1.0.0
  title: Personal Accounting REST API

paths:
  /livez:
    get:
      description: liveness check - checks if process is deadlocked
      responses:
        '200':
          description: process is running fine
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    description: ''

  /readyz:
    get:
      description: readiness check - checks if process can handle traffic (also considers downstream dependencies)
      responses:
        '200':
          description: process is running fine
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    description: ''

  /api/v1/accounting/transactions:
    get:
      tags: [accounting]
      summary: List all transactions
      parameters:
        - name: start_date
          in: query
          description: 'Filter transactions from this date (inclusive). Format: YYYY-MM-DD'
          required: false
          schema:
            type: string
            format: date
            example: '2026-01-01'
        - name: end_date
          in: query
          description: 'Filter transactions until this date (inclusive). Format: YYYY-MM-DD'
          required: false
          schema:
            type: string
            format: date
            example: '2026-01-31'
      responses:
        '200':
          description: 200 OK - Success Response
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Transaction'

    post:
      tags: [accounting]
      summary: Create transaction
      responses:
        '201':
          description: Created

  /api/v1/accounting/transactions/{transaction_id}:
    put:
      summary: Update or finalize a generated transaction
      tags: [accounting]
      parameters:
        - name: transaction_id
          in: path
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [date, description, entries]
              properties:
                date: { type: string, format: date }
                description: { type: string, example: 'Starbucks (Corrected)' }
                entries:
                  type: array
                  minItems: 1
                  items:
                    $ref: '#/components/schemas/Entry'
      responses:
        '204':
          description: Transaction updated successfully

  /api/v1/accounting/accounts/info:
    get:
      tags: [accounting]
      summary: Balance and health check
      responses:
        '200':
          description: ...
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AccountStatus'

components:
  schemas:
    Transaction:
      type: object
      description: Double-entry accounting transaction
      required: [date, description, entries]
      properties:
        id: { type: string, format: uuid, readOnly: true }
        date: { type: string, format: date }
        description: { type: string }
        entries:
          type: array
          items:
            $ref: '#/components/schemas/Entry'

    Entry:
      description: Double-entry accounting entry - debit / credit
      type: object
      required: [transaction_id, debit_amount, credit_amount]
      properties:
        transaction_id:
          type: string
          format: string
          description: transaction id
        debit_amount:
          type: string
          format: number
          description: ...
        credit_amount:
          type: string
          format: number
          description: ...

    AccountStatus:
      type: object
      properties:
        account_id: { type: string, format: uuid }
        account_name: { type: string }
        balance: { type: integer }
        is_balanced:
          type: boolean
          description: 'False if the sum of all transaction legs for this account is inconsistent'
        warnings:
          type: array
          items: { type: string }
          example:
            ['Uncategorized offset detected', 'Transaction #452 is unbalanced']

    ErrorResponse: # RFC9457 (loosely)
      type: object
      required:
        - type
        - title
        - status
      properties:
        type:
          type: string
          format: uri
          description: A URI reference that identifies the problem type.
        title:
          type: string
          format: string
          description: A short, human-readable summary of the problem
        status:
          type: string
          format: integer
          description: The HTTP status code generated for this occurrence.
        detail:
          type: string
          format: string
          description: A human-readable explanation specific to this occurence.
        instance:
          type: string
          format: string
          description: A URI reference for this specific occurence (e.g. trace ID)
